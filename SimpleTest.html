<!DOCTYPE html>
<html>
  <head>
    <title>Minimal Cartogram</title>
    <script src="libs/d3.v3.min.js"></script>
    <script src="libs/topojson.js"></script>
    <script src="cartogram.js"></script>
    <style type="text/css">

      path.state {
        stroke: #666;
        stroke-width: .5;
      }

      path.state:hover {
        stroke: #000;
      }
    </style>
  </head>
  <body>
    <div id="container">
      <h1>Cartograms with d3 &amp; TopoJSON</h1>
      <form>
        <p>
          <label>Scale by <select id="field"></select></label>
          <label>in <select id="year"></select></label>
        </p>
      </form>
      <div id="map-container">
        <svg id="map"></svg>
      </div>
    </div>
    <script>
      var features, geometries;
      var map = d3.select("#map"),
          layer = map.append("g")
            .attr("id", "layer"),
          states = layer.append("g")
            .attr("id", "states")
            .selectAll("path");

var proj = d3.geo.albersUsa();
   var cartogram = d3.cartogram()
     .projection(d3.geo.albersUsa())
     .value(function(d) {
       return Math.random() * 100;
     });
      d3.json("data/us-states.topojson", function(topology) {

     geometries = topology.objects.states.geometries;
     features = cartogram.features(topology, geometries);

     d3.select("svg").selectAll("path")
       .data(features)
       .enter()
       .append("path")
         .attr("d", cartogram.path);
    });        
      var path = d3.geo.path()
              .projection(proj);
console.log(states)
      var states = states.data(features)
                .enter()
          .append("path")
            .attr("class", "state")
            .attr("fill", "#ffffff")
            .attr("d", path);
   
     
      // on event fire, this function is called
      window.onclick = function() {
        console.log("clciked");
        cartogram.value( function(d) { return Math.random() *100 })
      };


        // // generate the new features, pre-projected
        // var features = carto(topology, geometries).features;
        // // update the data
        // states.data(features)
        //    .select("title")
        //      .text(function(d) {
        //        return [d.properties.NAME, fmt(value(d))].join(": ");
        //      });
             
        // states.transition() 
        //   .duration(10000)
        //   .ease("linear")
        //   .attr("fill", function(d) {
        //     return color(value(d));
        //   })
        //   .attr("d", cartogram.path);
      
    </script>
  </body>
</html>
